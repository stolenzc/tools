<!DOCTYPE html>
<title>holiday</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    /* body{
        width: 100%;
        height: calc(100vh);
        background-color: black;
    }
    .show_content{
        width: 100%;
        height: calc(100vh);
        line-height: calc(100vh);
        resize: none;
        font-size: 50px;
        text-align: center;
        position: relative;
        color: white;
    } */
    * {
        margin: 0;
        padding: 0;
        border: 0;
    }
    body{
        width: 100%;
        height: 100vh;
        background-color: black;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .show_content {
        color: white;
        font-size: 50px;
        text-align: center;
    }
    .num_show {
        font-family: monospace
    }
</style>

<body>
    <div class="show_content" id="show_content">
        <span>当前是</span>
        <span id="now", class="num_show"></span>
        <br/>
        <span>距离</span>
        <span id="endDate", class="num_show"></span>
        <span id="holiday"></span>
        <!-- <span id="year", class="num_show"></span>
        <span>年</span>
        <span id="month", class="num_show"></span>
        <span>月</span>
        <span id="day", class="num_show"></span>
        <span>日</span>
        <span id="hour", class="num_show"></span>
        <span>时</span> -->
        <span>放假还剩</span>
        <span id="show_day", class="num_show"></span>
        <span>秒</span>
    </div>
    <script>
        Date.prototype.Format = function (fmt) {
            let o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "h+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (let k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        };

        const getLocationParams = (keyWords) => {
            // 提取路由值（字符串）
            let href = window.location.href;
            // 从占位符开始截取路由（不包括占位符）
            let query = href.substring(href.indexOf("?") + 1);
            // 根据 & 切割字符串
            let vars = query.split("&");
            for (let i = 0; i < vars.length; i++) {
                let pair = vars[i].split("=");
                // 根据指定的参数名去筛选参数值
                if (pair[0] == keyWords) {
                    return decodeURI(pair[1]);
                }
            }
            return "没有该参数信息";
        };

        // 获取假期时间
        endDateStr = getLocationParams("endDate")
        if (endDateStr == "没有该参数信息") {
            var end_date = nextFriday()
        }else{
            var end_date = new Date(endDateStr);
        }

        // 获取假期名称
        holiday = getLocationParams("holiday")
        if (holiday == "没有该参数信息") {
            holiday = "周五下班"
        }

        initialLoad();

        function setDateShow(){
            document.getElementById("now").innerText = new Date().Format("yyyy-MM-dd hh:mm:ss");
            document.getElementById("endDate").innerText = end_date.Format("yyyy-MM-dd hh:mm:ss");
            // document.getElementById("year").innerText = end_date.getFullYear();
            // document.getElementById("month").innerText = end_date.getMonth() + 1;
            // document.getElementById("day").innerText = end_date.getDate();
            // document.getElementById("hour").innerText = end_date.getHours();
        }
        function getHolidaySeconds(){
            // 获取剩余的秒数
            var now = new Date();
            var endDay = end_date.getDate();
            if (now > end_date) {
                return 0
            }
            // 获取到当前时间的毫秒不可能刚好为0，所以剩余秒数+1
            remainSeconds = parseInt((end_date - now) / 1000) + 1;
            // var day = now.getDate();
            // if (now.getHours() >= 18) {
            //     remainSeconds = 0
            // }else if (now.getHours()<8 || (now.getHours()==8 && now.getMinutes()<30)){
            //     remainSeconds = 9.5 * 60 * 60
            // }else{
            //     remainSeconds = 60 - now.getSeconds() + 60 * (59 - now.getMinutes()) + 60 * 60 * (17 - now.getHours())
            // }
            // for(i=day+1;i<=endDay;i++){
            //     remainSeconds += 60 * 60 * 9.5
            // }
            return remainSeconds
        }

        function nextFriday(){
            now = new Date();
            week = now.getDay();
            today = new Date(now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate());
            if (week < 6 && week > 0){
                friday = today.getTime() + (5 - week) * 24 * 60 * 60 * 1000 + 18.5 * 60 * 60 * 1000;
            // }else{
            //     friday = today.getTime() + (12 - week) * 24 * 60 * 60 * 1000 + 18.5 * 60 * 60 * 1000;
            }
            return new Date(friday);
        }

        function updateHolidaySeconds(){
            remainSeconds = getHolidaySeconds();
            if (remainSeconds>0){
                document.getElementById("show_day").innerText = remainSeconds;
                document.getElementById("now").innerText = new Date().Format("yyyy-MM-dd hh:mm:ss");
            }else{
                document.getElementById("show_content").innerHTML = '放假时间到了，快回家吧<br\><img src="/static/img/fly.webp">';
            }
            if (typeof timer != "undefined" && remainSeconds == 0) {
                clearInterval(timer);
            }
        }

        function initialLoad(){
            document.getElementById("holiday").innerText = holiday;
            setDateShow()
            updateHolidaySeconds()
        }

        var timer = setInterval(updateHolidaySeconds, 1000);

    </script>
</body>